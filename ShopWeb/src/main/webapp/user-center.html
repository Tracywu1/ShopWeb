<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>用户中心</title>
</head>
<script src="js/vue.js"></script>
<script src="element-ui/lib/index.js"></script>
<link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">
<body>
<!-- user center page -->
<!-- 用户中心 -->
<div id="user-center">
    <!-- 用户设置按钮 -->
    <button @click="showUserInfoDialog">用户设置</button>

    <!-- 用户信息对话框 -->
    <div v-if="showUserInfo">
        <!-- 编辑用户信息表单 -->
        <form>
            <label>用户名：</label>
            <input type="text" v-model="user.name">
            <br>

            <el-upload
                    class="avatar-uploader"
                    action="https://jsonplaceholder.typicode.com/posts/"
                    :show-file-list="false"
                    :on-success="handleAvatarSuccess"
                    :before-upload="beforeAvatarUpload">
                <img v-if="imageUrl" :src="imageUrl" class="avatar">
                <i v-else class="el-icon-plus avatar-uploader-icon"></i>
            </el-upload>

            <br>
            <label>收货地址：</label>
            <textarea v-model="user.address"></textarea>
            <br>
            <label>手机号：</label>
            <input type="text" v-model="user.phone">
            <br>
            <button type="submit" @click.prevent="saveUserInfo">保存</button>
        </form>
    </div>

    <!-- 商品列表 -->
    <div>
        <button @click="showGoods('shipped')">已发货</button>
        <button @click="showGoods('unshipped')">未发货</button>
        <button @click="showGoods('received')">已收货</button>
        <button @click="showGoods('after-sale')">售后</button>

        <ul>
            <li v-for="item in goodsList">{{ item.name }} {{ item.price }}</li>
        </ul>
    </div>

    <!-- 收货地址按钮 -->
    <button @click="showEditAddressDialog">收货地址</button>

    <!-- 编辑收货地址对话框 -->
    <div v-if="showEditAddressDialog">
        <el-dialog title="编辑收货地址"
                   :visible.sync="showEditAddressDialog"
                   width="30%"
        >
            <el-form :model="editAddressForm" label-width="80px">
                <el-form-item label="收货人姓名">
                    <el-input v-model="editAddressForm.name"></el-input>
                </el-form-item>
                <el-form-item label="收货地址">
                    <el-input v-model="editAddressForm.address"></el-input>
                </el-form-item>
                <el-form-item label="手机号码">
                    <el-input v-model="editAddressForm.phone"></el-input>
                </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button @click="showEditAddressDialog = false">取 消</el-button>
                <el-button type="primary" @click="saveAddress">确 定</el-button>
            </div>
        </el-dialog>
    </div>

    <!-- 收货地址按钮 -->
    <button @click="showReturnDialog">收货地址</button>

    <!-- 退货操作对话框 -->
    <div v-if="showReturnDialog">
        <el-dialog title="退货操作"
                   :visible.sync="showReturnDialog"
                   width="30%"
        >
            <p>确认要退货吗？</p>
            <div slot="footer" class="dialog-footer">
                <el-button @click="showReturnDialog = false">取 消</el-button>
                <el-button type="danger" @click="doReturn">确 定</el-button>
            </div>
        </el-dialog>
    </div>
</div>

<script>
    new Vue({
        el: "#user-center",
        data() {
        return {
        showUserInfo: false, // 是否显示用户信息对话框
        user: {}, // 用户信息

        goodsList: [], // 商品列表

        showEditAddressDialog: false, // 是否显示编辑收货地址对话框
        editAddressForm: {}, // 编辑收货地址表单

        showReturnDialog: false, // 是否显示退货操作对话框
    }
    },

        methods: {
        // 获取用户信息
        getUserInfo() {
        axios.get('/api/user/info')
        .then(response => {
        this.user = response.data
    })
        .catch(error => {
        console.log(error)
    })
    },

        // 保存用户信息
        saveUserInfo() {
        axios.post('/api/user/info', this.user)
        .then(response => {
        this.showUserInfo = false
    })
        .catch(error => {
        console.log(error)
    })
    },

        // 上传头像
        uploadAvatar() {
        // 实现上传头像的代码
    },

        // 显示商品列表
        showGoods(status) {
        axios.get('/api/user/goods', {params: {status: status}})
        .then(response => {
        this.goodsList = response.data
    })
        .catch(error => {
        console.log(error)
    })
    },

        // 显示编辑收货地址对话框
        showEditAddress() {
        this.showEditAddressDialog = true
        this.editAddressForm = this.user.address
    },

        // 保存收货地址
        saveAddress() {
        axios.post('/api/user/address', this.editAddressForm)
        .then(response => {
        this.user.address = this.editAddressForm
        this.showEditAddressDialog = false
    })
        .catch(error => {
        console.log(error)
    })
    },

        // 显示退货操作对话框
        showReturn() {
        this.showReturnDialog = true
    },

        // 退货操作
        doReturn() {
        // 实现退货操作的代码
    },

        // 显示用户信息对话框
        showUserInfoDialog() {
        this.showUserInfo = true
        this.getUserInfo()
    },
    },
        mounted() {
        this.showGoods('shipped')
    },
    }
</script>

</body>
</html>
