<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商品详情页</title>
    <style>
        #product-img {
            max-width: 400px;
            max-height: 400px;
        }
    </style>
</head>
<body>

<div class="top ">
    <a href="homepage.html">
        <span style="color:#C40000;margin:0px"
              class=" glyphicon glyphicon-home redColor">
        </span> QG购物商城首页</a >

    <span>hi，欢迎来到QG购物商城</span>

    <a href="login.html">请登录</a>
    <a href="register.html">免费注册</a>

    <span class="pull-right">
    <a href="bought.html">我的订单</a>
    <a href="cart.html">
    <span style="color:#C40000;margin:0px" class=" glyphicon glyphicon-shopping-cart redColor"></span>
    购物车</a>
</span>
    <!--假的-->
    <input type="text" placeholder="平衡车 原汁机" name="keyword">
    <button class="searchButton" type="submit">搜索</button>
</div>

    <div id="app">
        <div class="product-image">
            <img :src="product.image" :alt="product.name" />
        </div>
        <div class="product-details">
            <h1>{{ product.name }}</h1>
            <p>价格：{{ product.price }}元</p>
            <p>描述：{{ product.description }}</p>
            <p>库存：{{product.productCount}}件</p>
            <p>月销量：{{ product.monthlySalesCount }}件</p>
            <div>
                <h2>评论：</h2>
                <ul>
                    <li v-for="comment in comments" :key="comment.id">
                        {{comment.nickName}}:{{ comment.content }}
                    </li>
                </ul>
            </div>
            <div>
                <input type="number" v-model="quantity" min="1" max="10">
                <button @click="addToCart(product.id, quantity)">添加到购物车</button>
            </div>
            <button @click="buyNow(product.id)">立即购买</button>
            <button @click="consult()">咨询</button>
            <a :href="'store.html?id=' + product.storeId">访问店铺</a>
        </div>
    </div>


    <script src="js/vue.js"></script>
    <script src="js/axios-0.18.0.js"></script>

    <script>
        const app = new Vue({
            el: '#app',
            data() {
                return {
                    product: {},
                    comments: [],
                    quantity: 1
                };
            },
            created() {
                // 获取商品ID
                const productId = this.getProductIdFromUrl();

                // 获取商品详细信息和评论
                axios.get(`product/user/selectById?id=${productId}`)
                    .then(response => {
                        this.product = response.data.data;
                        this.comments = response.data.data.commentList;
                    })
                    .catch(error => console.error(error));
            },
            methods: {
                // 从URL中获取商品ID
                getProductIdFromUrl() {
                    const urlParams = new URLSearchParams(window.location.search);
                    return urlParams.get('id');
                },
                // 立即购买
                buyNow(productId) {
                    axios.post(`order/create`)
                        .then(response => {
                            if (response.data.code === 10000) {
                                alert('购买成功');
                            } else {
                                alert('购买失败');
                            }
                        })
                        .catch(error => console.error(error));
                },

                // 咨询
                consult() {
                    // 弹出聊天窗口或跳转到聊天界面
                },
            },
        });
    </script>
</body>
</html>
