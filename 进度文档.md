# 记录文档

## 数据库设计：

逻辑外键--->后端程序实现物理外键的功能

表之间的关系

注意字段、数据类型的对应问题

## 数据库连接池：

什么时候关闭：对CURDUtils进行监听，如果超过规定时间没有使用该工具类，就关闭

## 事务管理：

service层增删改操作：开启 提交 回滚X---->curdutils

用日志来记录事务

解决完池再来

```java
public void delete(Integer id) throws Exception {
    Connection conn = null;
    try {
        conn = getConnection(); //获取数据库连接
        conn.setAutoCommit(false); //关闭自动提交事务

        deptMapper.deleteById(id); //根据ID删除部门数据

        int i = 1/0;
        //if(true){throw new Exception("出错啦...");}

        empMapper.deleteByDeptId(id); //根据部门ID删除该部门下的员工

        conn.commit(); //提交事务
    } catch (Exception e) {
        conn.rollback(); //回滚事务
        throw e;
    } finally {
        closeConnection(conn); //关闭数据库连接

        DeptLog deptLog = new DeptLog();
        deptLog.setCreateTime(LocalDateTime.now());
        deptLog.setDescription("执行了解散部门的操作,此次解散的是"+id+"号部门");
        deptLogService.insert(deptLog);
    }
}
```

```java
public class DeptLogServiceImpl implements DeptLogService {

    private DeptLogMapper deptLogMapper;

    public DeptLogServiceImpl(DeptLogMapper deptLogMapper) {
        this.deptLogMapper = deptLogMapper;
    }

    @Override
    public void insert(DeptLog deptLog) throws Exception {
        Connection conn = null;
        try {
            conn = getConnection(); //获取数据库连接
            conn.setAutoCommit(false); //关闭自动提交事务

            deptLogMapper.insert(deptLog); //插入部门日志

            conn.commit(); //提交事务
        } catch (Exception e) {
            conn.rollback(); //回滚事务
            throw e;
        } finally {
            closeConnection(conn); //关闭数据库连接
        }
    }

    //获取数据库连接的方法
    private Connection getConnection() throws SQLException {
        //根据具体的数据库连接方式实现
        return DriverManager.getConnection("jdbc:mysql://localhost:3306/test?useSSL=false", "username", "password");
    }

    //关闭数据库连接的方法
    private void closeConnection(Connection conn) {
        if (conn != null) {
            try {
                conn.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}

```

## Double不能设置为null:

